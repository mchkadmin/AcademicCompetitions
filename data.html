<!DOCTYPE html>
<html>
<head>
    <title>MCHK Approved Competitions Dataset</title>
    <style>
        /* --- General Styling (Dark Mode) --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background-color: #F8FAF*; /* Dark background */
            color: #E0E0E0; /* Light text */
        }
        h1 { color: #81C784; /* Light Green for heading */ }

        /* --- Filter Controls Style --- */
        #filter-controls { 
            margin-bottom: 25px; 
            padding: 20px; 
            background-color: #1E1E1E; /* Slightly lighter dark background for controls */
            border-radius: 8px; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex; /* Use flexbox for layout */
            flex-direction: column;
            gap: 15px;
        }
        #main-filters, #p-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }
        label { font-weight: bold; color: #BBDEFB; /* Light Blue for labels */ }
        select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #333;
            background-color: #2D2D2D;
            color: #E0E0E0;
            cursor: pointer;
        }
        
        /* --- Checkbox Styling for P1-P6 --- */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        input[type="checkbox"] {
            margin: 0;
            transform: scale(1.2);
            cursor: pointer;
        }

        /* --- Table Styling (Sortable) --- */
        #competitions-table { 
            width: 100%; 
            border-collapse: collapse; 
            background-color: #7F9C90;
            border-radius: 8px;
            overflow: hidden;
        }
        #competitions-table th, #competitions-table td { 
            padding: 12px 15px; 
            border: none;
            border-bottom: 1px solid #333;
            text-align: left; 
        }
        #competitions-table th { 
            background-color: #0031D; 
            color: #FFFFFF; 
            cursor: pointer; /* Indicate sortability */
            position: relative;
        }
        #competitions-table th:hover {
            background-color: #3A3A3A;
        }
        #competitions-table tbody tr:hover {
            background-color: #252525;
        }
        
        /* Sort indicator arrow */
        .sort-asc::after { content: ' ‚ñ≤'; }
        .sort-desc::after { content: ' ‚ñº'; }
        
        /* Style for icons in cells */
        #competitions-table td:has(> .icon) { text-align: center; }

    </style>
</head>
<body>
    <h1>MCHK Approved Competitions</h1>

    <div id="filter-controls">
        <h3>Filter Competitions</h3>
        
        <div id="main-filters">
            <label for="category-filter">Category:</label>
            <select id="category-filter" onchange="applyFilters()">
                <option value="">All Categories</option>
            </select>
            
            <label for="difficulty-filter">Difficulty (1-5):</label>
            <select id="difficulty-filter" onchange="applyFilters()">
                <option value="">All Difficulties</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
            
            <label for="season-filter">Season:</label>
            <select id="season-filter" onchange="applyFilters()">
                <option value="">All Seasons</option>
            </select>
        </div>

        <div id="p-filters">
            <label>Eligibility:</label>
            <div id="p-checkboxes" onchange="applyFilters()">
                </div>
        </div>
    </div>

    <table id="competitions-table">
        <thead></thead>
        <tbody id="table-body">
            <tr><td colspan="30" style="text-align: center;">Loading data...</td></tr>
        </tbody>
    </table>

    <script>

// --- Initialization ---

let rawData = [];
let mchkApprovedData = [];
let currentSortColumn = null;
let currentSortDirection = 'asc';

const MCHK_HEADER = "Approved for MCHK";
const DIFFICULTY_HEADER = "Difficulty (1-5)";
const PRIMARY_CATEGORY_HEADER = "Category";
const SEASON_HEADER = "Season";
const P_HEADERS = ["P1", "P2", "P3", "P4", "P5", "P6","Fy1","Fy2", "Fy3","Re","Hu","L6","U6"];

async function loadData() {
    try {
        const response = await fetch('competitions.json');
        const jsonText = await response.text();
        rawData = JSON.parse(jsonText);
        
        // --- üö® NEW: Standardize Data Types Immediately ---
        rawData.forEach(item => {
            // Check if the property exists and is not an empty string
            if (item.hasOwnProperty(DIFFICULTY_HEADER) && item[DIFFICULTY_HEADER] !== "") {
                // This converts the number to an integer
                item[DIFFICULTY_HEADER] = parseInt(item[DIFFICULTY_HEADER], 10);
            } else {
                // Ensure null for empty/missing values for safe comparison
                item[DIFFICULTY_HEADER] = null;
            }
        });
        // -------------------------------------------------
        
        // --- ‚úÖ DEBUGGING: Logs are now placed OUTSIDE the forEach loop ---
        // These logs will run only once after all data is processed.
        console.log("Expected Difficulty Header:", DIFFICULTY_HEADER);
        console.log("First five standardized items:", rawData.slice(0, 5));
        // ------------------------------------------------------------------
        
        // 1. Apply Initial Filter: Only keep Approved for MCHK=TRUE
        mchkApprovedData = rawData.filter(item => item[MCHK_HEADER] === 'TRUE');
        
        if (mchkApprovedData.length === 0) {
            document.getElementById('table-body').innerHTML = '<tr><td colspan="10">No MCHK Approved Competitions found.</td></tr>';
            return;
        }

        const headers = Object.keys(mchkApprovedData[0]); 
        
        createTableHeaders(headers);
        populateFilters(mchkApprovedData);
        displayData(mchkApprovedData);
        
    } catch (error) {
        console.error("Error loading JSON:", error);
        document.getElementById('table-body').innerHTML = '<tr><td colspan="10">Error loading data. See console.</td></tr>';
    }
}
// -----------------------------------------------------

// --- Dynamic Table Creation ---

function createTableHeaders(headers) {
    const thead = document.querySelector('#competitions-table thead');
    thead.innerHTML = ''; 
    const row = thead.insertRow();
    
    headers.forEach((header, index) => {
        if (header !== MCHK_HEADER) {
            const th = document.createElement('th');
            th.textContent = header;
            // Add a data attribute to store the column index for sorting
            th.setAttribute('data-column-name', header); 
            th.onclick = () => sortTable(header); // Attach click handler
            
            // Add sort indicator if it's the current sort column
            th.className = (header === currentSortColumn) ? 
                            (currentSortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : '';
            
            row.appendChild(th);
        }
    });
}

function displayData(data) {
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = ''; 
    
    if (data.length === 0) {
        // Updated colspan to cover a wide table, ensure it's large enough
        tbody.innerHTML = '<tr><td colspan="30" style="text-align: center;">No results match your filters.</td></tr>'; 
        return;
    }
    
    const headers = Object.keys(data[0]);

    data.forEach(item => {
        const row = tbody.insertRow();
        
        headers.forEach(header => {
            if (header !== MCHK_HEADER) {
                const cell = row.insertCell();
                let value = item[header];
                
                // Special handling for boolean/checkbox columns
                if (value === 'TRUE') {
                    cell.innerHTML = '<span class="icon">‚úÖ</span>';
                } else if (value === 'FALSE') {
                    cell.innerHTML = '<span class="icon">‚ùå</span>';
                } else if (header === DIFFICULTY_HEADER) {
                    // Display difficulty clearly, handle nulls for robustness
                    cell.textContent = value !== null ? value : '';
                } else {
                    cell.textContent = value;
                }
            }
        });
    });
    // Re-create headers to ensure sort indicators are updated
    createTableHeaders(headers); 
}

function displayData(data) {
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = ''; 
    
    if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10">No results match your filters.</td></tr>';
        return;
    }
    
    const headers = Object.keys(data[0]);

    data.forEach(item => {
        const row = tbody.insertRow();
        
        headers.forEach(header => {
            // Again, skip the MCHK approval column for display
            if (header !== MCHK_HEADER) {
                const cell = row.insertCell();
                let value = item[header];
                
                // Special handling for boolean/checkbox columns
                if (value === 'TRUE') {
                    cell.innerHTML = '‚úÖ';
                } else if (value === 'FALSE') {
                    cell.innerHTML = '‚ùå';
                } else {
                    cell.textContent = value;
                }
            }
        });
    });
}

// --- Filter Population ---



function populateFilters(data) {
    const categorySelect = document.getElementById('category-filter');
    const seasonSelect = document.getElementById('season-filter');
    const pCheckboxesDiv = document.getElementById('p-checkboxes');
    
    // Clear old options while preserving the default "All" option
    categorySelect.querySelectorAll('option:not(:first-child)').forEach(o => o.remove());
    seasonSelect.querySelectorAll('option:not(:first-child)').forEach(o => o.remove());
    pCheckboxesDiv.innerHTML = ''; // Clear old checkboxes

    const primaryCategories = new Set();
    const seasons = new Set();

    data.forEach(item => {
        if (item[PRIMARY_CATEGORY_HEADER]) {
            primaryCategories.add(item[PRIMARY_CATEGORY_HEADER]);
        }
        if (item[SEASON_HEADER]) {
            seasons.add(item[SEASON_HEADER]);
        }
    });

    // Populate Primary Category Filter
    Array.from(primaryCategories).sort().forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
    });
    
    // Populate Season Filter
    Array.from(seasons).sort().forEach(season => {
        const option = document.createElement('option');
        option.value = season;
        option.textContent = season;
        seasonSelect.appendChild(option);
    });
    
    // Populate P1-P6 Checkboxes
    P_HEADERS.forEach(pHeader => {
        const wrapper = document.createElement('div');
        wrapper.className = 'checkbox-group';
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `filter-${pHeader}`;
        checkbox.value = pHeader;
        
        const label = document.createElement('label');
        label.setAttribute('for', `filter-${pHeader}`);
        label.textContent = pHeader;
        
        wrapper.appendChild(checkbox);
        wrapper.appendChild(label);
        pCheckboxesDiv.appendChild(wrapper);
    });
}

// --- Core Filtering Logic ---


function applyFilters() {
    const primaryCategoryFilter = document.getElementById('category-filter').value; 
    const difficultyFilter = document.getElementById('difficulty-filter').value;
    const seasonFilter = document.getElementById('season-filter').value;
    
    // Collect active P filters
    const activePFilters = P_HEADERS.filter(pHeader => 
        document.getElementById(`filter-${pHeader}`) && document.getElementById(`filter-${pHeader}`).checked
    );

    let filteredData = mchkApprovedData;

    // Filter 1: Primary Category
    if (primaryCategoryFilter) {
        filteredData = filteredData.filter(item => item[PRIMARY_CATEGORY_HEADER] === primaryCategoryFilter);
    }

    // Filter 2: Difficulty
    if (difficultyFilter) {
        const filterNumber = parseInt(difficultyFilter, 10); 
        filteredData = filteredData.filter(item => item[DIFFICULTY_HEADER] === filterNumber);
    }
    
    // Filter 3: Season
    if (seasonFilter) {
        filteredData = filteredData.filter(item => item[SEASON_HEADER] === seasonFilter);
    }
    
    // Filter 4: P1-P6 Checkboxes (Must meet ALL checked criteria)
    if (activePFilters.length > 0) {
        filteredData = filteredData.filter(item => 
            // Check if every active P filter is 'TRUE' for the current item
            activePFilters.every(pHeader => item[pHeader] === 'TRUE')
        );
    }

    // Reset sort state when filters change, then display
    currentSortColumn = null;
    currentSortDirection = 'asc';
    displayData(filteredData);
}
// -----------------------------------------------------
        // --- Sorting Logic ---
function sortTable(columnName) {
    const isNewColumn = currentSortColumn !== columnName;

    // 1. Determine new direction and column
    if (isNewColumn) {
        currentSortColumn = columnName;
        currentSortDirection = 'asc';
    } else {
        currentSortDirection = (currentSortDirection === 'asc') ? 'desc' : 'asc';
    }

    // 2. Get the current filtered data from the table body
    const currentTableRows = Array.from(document.getElementById('table-body').rows);
    
    // Map back to the original data structure for consistent sorting
    const dataToSort = currentTableRows.map(row => {
        const item = {};
        const headers = Object.keys(mchkApprovedData[0]);
        let headerIndex = 0;
        
        // Reconstruct the item object from the cell content
        Array.from(row.cells).forEach(cell => {
            let header = headers.find(h => h !== MCHK_HEADER && h !== 'Approved For MCC' && h !== 'Approved For MCT');
            
            // Find the correct header based on the column name
            const displayHeaders = headers.filter(h => h !== MCHK_HEADER);
            header = displayHeaders[headerIndex];
            
            // Get value from cell's textContent or use internal data if possible
            let value = cell.textContent;
            
            // If the value is an icon, use the internal TRUE/FALSE/Number value instead
            const originalItem = mchkApprovedData.find(d => d["Competition Name"] === row.cells[displayHeaders.indexOf("Competition Name")].textContent);

            if (originalItem && originalItem.hasOwnProperty(header)) {
                 value = originalItem[header];
            } else if (cell.querySelector('.icon')) {
                value = cell.querySelector('.icon').textContent === '‚úÖ' ? 'TRUE' : 'FALSE';
            }
            
            item[header] = value;
            headerIndex++;
        });
        return item;
    });

    // 3. Sort the data
    dataToSort.sort((a, b) => {
        const aVal = a[currentSortColumn];
        const bVal = b[currentSortColumn];

        let comparison = 0;
        
        // Handle numbers (like Difficulty)
        if (typeof aVal === 'number' && typeof bVal === 'number') {
            comparison = aVal - bVal;
        } 
        // Handle boolean/TRUE/FALSE (P1, Available to MCHK etc.)
        else if (aVal === 'TRUE' || aVal === 'FALSE') {
             // TRUE sorts before FALSE in ASC
            comparison = (aVal === 'TRUE' ? 1 : 0) - (bVal === 'TRUE' ? 1 : 0);
        }
        // Handle strings (most other columns)
        else {
            comparison = String(aVal).localeCompare(String(bVal));
        }

        return currentSortDirection === 'asc' ? comparison : -comparison;
    });

    // 4. Re-display the sorted data
    displayData(dataToSort);
}

// Start the process
loadData();
    </script>
</body>
</html>
